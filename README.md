

# Rutracker/Pornolab Viewer с Управлением Геймпадом

Этот проект представляет собой веб-интерфейс для удобного просмотра торрент-раздач с сайтов Rutracker.org и Pornolab.net (ограниченный функционал) с возможностью навигации и управления с помощью геймпада. Проект использует локальный [TorAPI](https://github.com/Lifailon/TorAPI) для получения данных о раздачах и кастомный Node.js бэкенд для некоторых дополнительных функций (например, поиска видео на YouTube).

## Основной функционал

*   **Выбор источника:** Возможность переключаться между просмотром данных с Rutracker и Pornolab.
*   **Отображение сеткой:** Раздачи представлены в виде сетки постеров для наглядного обзора.
*   **Пагинация:** Поддержка постраничного просмотра раздач.
*   **Модальное окно (для Rutracker):**
    *   Отображение увеличенного постера.
    *   Отображение **полного HTML-описания** первого поста темы.
    *   Отображение **дополнительных деталей**: Год, Жанр, Озвучка, Язык текста, Возрастной рейтинг, Статус мультиплеера.
    *   Встроенный **YouTube-плеер**, автоматически находящий и воспроизводящий трейлер/геймплей по названию.
    *   Прямая ссылка на страницу темы на трекере.
    *   Ссылка для скачивания `.torrent` файла (через `dl.php`) или Magnet-ссылка.
*   **Быстрый доступ (для Pornolab):**
    *   Отображение горизонтальных постеров (4 в ряд).
    *   Под постером отображаются **основные детали**: Сиды, Пиры, Размер, Видео, Тип.
    *   **Клик по карточке** сразу инициирует скачивание торрента (предпочтительно Magnet, иначе `dl.php`).
*   **Индикатор мультиплеера:** На карточках раздач (в обоих режимах) отображается зеленый кружок, если парсер определил наличие мультиплеера.
*   **Управление геймпадом:**
    *   **Сетка:** Навигация (D-Pad/Левый стик), выбор постера (A/X).
    *   **Пагинация:** Переход на кнопки пагинации (D-Pad/Левый стик с краев сетки), навигация по кнопкам (D-Pad/Левый стик влево/вправо), активация кнопки (A/X), возврат на сетку (B/O, D-Pad/Левый стик вверх/вниз).
    *   **Переключение страниц:** LB/RB в любом контексте (сетка, пагинация, модалка).
    *   **Модальное окно (Rutracker):** Закрытие (B/O, Escape), навигация по ссылкам (D-Pad/Левый стик), активация ссылок (A/X), скролл контента (D-Pad/Правый стик вверх/вниз).
*   **Обновление данных:** Скрипт `parser.py` сканирует указанное количество страниц выбранного трекера, находит новые ID раздач (сравнивая с существующим `data.json` или `pornolab_data.json`), запрашивает детали по этим новым ID у локального TorAPI и обновляет соответствующий JSON-файл.

## Технологии

*   **Бэкенд:**
    *   **Node.js + Express.js:** Основной сервер, раздает статику, предоставляет API для данных и YouTube.
    *   **Python:** Скрипт `parser.py` для сбора ID с трекеров и обновления файлов данных через TorAPI.
    *   **TorAPI (Локальный):** Используется как прокси для получения данных с трекеров по ID.
    *   **dotenv:** Для управления переменными окружения (API ключи, порты).
    *   **axios:** Для выполнения HTTP-запросов (в Node.js).
    *   **requests, beautifulsoup4, lxml:** Для выполнения HTTP-запросов и парсинга HTML (в Python).
*   **Фронтенд:**
    *   HTML5
    *   CSS3 (включая Grid Layout)
    *   JavaScript (Vanilla JS, Fetch API, Gamepad API)

## Структура проекта

```
/ (корневая папка, например O:\hh\)
├── TorAPI-main/          # Папка с локально развернутым TorAPI
├── node_modules/         # Зависимости Node.js
├── public/               # Файлы фронтенда
│   ├── index.html        # Страница для Rutracker
│   ├── style.css         # Основные стили
│   ├── script.js         # Основной JS для Rutracker (с геймпадом)
│   ├── pornolab.html     # Страница для Pornolab
│   ├── pornolab.css      # Стили для Pornolab
│   └── pornolab.js       # JS для Pornolab (без геймпада)
├── parser.py             # Скрипт обновления данных
├── server.js             # Основной Node.js бэкенд сервер
├── data.json             # Данные для Rutracker (генерируется)
├── pornolab_data.json    # Данные для Pornolab (генерируется)
├── package.json          # Зависимости Node.js
├── package-lock.json     # Блокировка версий зависимостей
├── .env                  # Переменные окружения (ВАЖНО: не добавлять в Git!)
└── manage_servers.bat    # (Пример) Скрипт для управления серверами (или start_servers.bat)
```

## Установка и запуск

1.  **Клонируйте репозиторий TorAPI:**
    *   Перейдите в корневую папку проекта (`O:\hh\`).
    *   Выполните: `git clone https://github.com/Lifailon/TorAPI.git TorAPI-main` (или скачайте архив и распакуйте в папку `TorAPI-main`).
    *   Перейдите в папку TorAPI: `cd TorAPI-main`
    *   Установите зависимости TorAPI: `npm install`
    *   Вернитесь обратно: `cd ..`

2.  **Установите зависимости основного бэкенда:**
    *   В корневой папке проекта (`O:\hh\`) выполните: `npm install express axios cors dotenv`

3.  **Установите зависимости Python:**
    *   Убедитесь, что у вас установлен Python 3.
    *   Выполните: `pip install requests beautifulsoup4 lxml python-dotenv`

4.  **Настройте переменные окружения:**
    *   Создайте файл `.env` в корневой папке (`O:\hh\`).
    *   Добавьте в него следующие строки, заменив значения на ваши:
        ```dotenv
        YOUTUBE_API_KEY=ВАШ_КЛЮЧ_API_YOUTUBE_ЗДЕСЬ
        BACKEND_PORT=3000
        # Добавьте другие переменные, если они нужны (например, куки для parser.py)
        # BB_SESSION_RUTRACKER=ВАШ_bb_session_ДЛЯ_RUTRACKER
        # BB_SESSION_PORNOLAB=ВАШ_bb_session_ДЛЯ_PORNOLAB
        ```
    *   **ВАЖНО:** Добавьте `.env` в ваш файл `.gitignore`, чтобы случайно не загрузить ключи в репозиторий!
    *   Если вы добавили куки в `.env`, раскомментируйте и заполните словарь `COOKIES` в `parser.py`, используя `os.environ.get()`.

5.  **Запуск серверов и парсера:**
    *   Используйте предоставленный `.bat` скрипт (`manage_servers.bat` или `start_servers.bat`) для удобного запуска/остановки. Он запустит:
        *   TorAPI (`npm start` из папки `TorAPI-main`).
        *   Основной бэкенд (`node server.js` из корневой папки).
    *   Или запустите их вручную в отдельных терминалах:
        *   Терминал 1: `cd TorAPI-main` -> `npm start`
        *   Терминал 2: `cd O:\hh\` -> `node server.js`
    *   **Для обновления данных** запустите парсер: `cd O:\hh\` -> `python parser.py`. Он запросит источник и количество страниц.

6.  **Доступ к интерфейсу:**
    *   **Rutracker Viewer:** Откройте в браузере `http://localhost:3000` (или порт, указанный в `BACKEND_PORT`).
    *   **Pornolab Viewer:** Откройте в браузере `http://localhost:3000/pornolab` (или ваш порт + `/pornolab`).

## Необходимые компоненты

*   Node.js и npm (для запуска TorAPI и основного бэкенда)
*   Python 3 (для запуска скрипта парсера)
*   pip (менеджер пакетов Python)
*   Ключ API YouTube v3 (Google Cloud Platform) - для работы поиска видео.

## Заметки

*   Локальный TorAPI должен быть запущен перед запуском `parser.py`.
*   Бэкенд `server.js` должен быть запущен для работы веб-интерфейса.
*   `parser.py` необходимо запускать периодически для обновления данных в файлах `data.json` и `pornolab_data.json`.
*   Эффективность сбора ID с трекеров зависит от настроек `MAX_WORKERS_ID_FETCH` и `WORKER_SLEEP_MIN/MAX`. Слишком агрессивные настройки могут привести к временной блокировке IP.
*   Кодировка всех текстовых файлов (`.html`, `.js`, `.css`, `.py`, `.json`, `.env`) должна быть **UTF-8**.
*   Селекторы для парсинга страниц трекеров (`get_total_pages`, `fetch_and_extract_ids_from_page` в `parser.py`) могут потребовать обновления, если изменится HTML-структура сайтов.

---

Не стесняйтесь дополнять или изменять это описание в соответствии с вашими потребностями!
